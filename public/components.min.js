//////////////////////////////////////////////////////////////////////////////80
// Minification / Creation Time: 2022-03-02 02:24:06
//////////////////////////////////////////////////////////////////////////////80
// Copyright (c) 2020 Liam Siira (liam@siira.io), distributed as-is and without
// warranty under the MIT License. See [root]/docs/LICENSE.md for more.
// This information must remain intact.
//////////////////////////////////////////////////////////////////////////////80

//////////////////////////////////////////////////////////////////////////////80
// components/active/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(global){var ace=global.ace,atheos=global.atheos;var self=null;var EditSession=ace.require('ace/edit_session').EditSession;var UndoManager=ace.require('ace/undomanager').UndoManager;carbon.subscribe('system.loadMajor',()=>atheos.active.init());atheos.active={tabList:oX('#active_file_tabs'),dropDownMenu:oX('#active_file_dropdown'),sessions:{},loopBehavior:'loopActive',dropDownOpen:!1,init:function(){self=this;self.updateTabDropdownVisibility();self.initTabListeners();atheos.common.initMenuHandler('#tab_dropdown','#active_file_dropdown',['fa-chevron-circle-down','fa-chevron-circle-up']);fX('#tab_close').on('click',function(e){e.stopPropagation();self.closeAll()});fX('#reload_file').on('click',()=>self.reload());fX('#reset_file').on('click',()=>self.reset());echo({url:atheos.controller,data:{target:'active',action:'list'},settled:function(status,reply){if(status!=='success')return;var inFocus=reply.inFocus,key,item;delete reply.inFocus;for(key in reply){item=reply[key];if(!inFocus)item.status=inFocus='inFocus';atheos.filemanager.openFile(item.path,item.status==='inFocus')}}});window.onbeforeunload=function(e){let changedTabs=self.unsavedChanges();if(changedTabs){self.focus(changedTabs[0]);e=e||window.event;var errMsg='You have unsaved files.';if(e){e.returnValue=errMsg}
return errMsg}};window.onresize=self.updateTabDropdownVisibility;carbon.subscribe('settings.loaded',function(){self.loopBehavior=storage('active.loopBehavior')||self.loopBehavior;setTimeout(self.updateTabDropdownVisibility,500)})},unsavedChanges(){var changedTabs=[];var path;for(path in self.sessions){if(self.sessions[path].status==='changed'){changedTabs.push(path)}}
if(changedTabs.length>0){return changedTabs}
return!1},initTabListeners:function(){var activeListener=function(e){e.stopPropagation();var tagName=e.target.tagName;var node=oX(e.target);if(tagName==='UL'){return}
if(['I','A','SPAN'].indexOf(tagName)>-1){node=node.parent('LI')}
var path=node.attr('data-path');if(e.which===1&&tagName!=='I'){self.focus(path)}else if(e.which===2||tagName==='I'){var activePath=self.getPath();self.close(path);if(activePath!==null&&activePath!==path){self.focus(activePath)}
self.updateTabDropdownVisibility()}};fX('#active_file_tabs').on('click, auxclick',function(e){activeListener(e)});fX('#active_file_dropdown').on('click, auxclick',function(e){activeListener(e)});fX('#active_file_tabs').on('mousedown',self.handleDrag);fX('#active_file_tabs').on('dragstart',blackhole)},handleDrag:function(e){e.stopPropagation();var target=e.target;var origin,sibling;var dragZone=self.tabList.element;var clone,startEX,startEY,startMX,startMY,timeout;var xMax,yMax;function moveTarget(e){timeout=!1;var swap=[].slice.call(dragZone.querySelectorAll('.draggable'));swap=swap.filter((item)=>{var rect=item.getBoundingClientRect();if(e.clientX<rect.left||e.clientX>=rect.right)return!1;return(item!==clone)});if(swap.length===0)return;swap=swap[swap.length-1];if(dragZone.contains(swap)){swap=swap!==target.nextSibling?swap:swap.nextSibling;if(swap){swap.parentNode.insertBefore(target,swap)}}}
function dragMove(e){var x=startEX+e.screenX-startMX;x=(x>xMax)?xMax:((x<0)?0:x);clone.style.left=(x-dragZone.scrollLeft)+'px';if(timeout===!1){timeout=setTimeout(()=>moveTarget(e),50)}}
function dragStart(){timeout=!1;startEX=target.offsetLeft;startEY=target.offsetTop;startMX=e.screenX;startMY=e.screenY;clone=target.cloneNode(!0);clone.style.left=(startEX-dragZone.scrollLeft)+'px';clone.style.top=(startEY-dragZone.scrollTop)+'px';clone.style.position='absolute';clone.style.cursor='grabbing';dragZone.append(clone);target.style.opacity=0;xMax=dragZone.offsetWidth-clone.offsetWidth;yMax=dragZone.offsetHeight-clone.offsetHeight;document.addEventListener('mousemove',dragMove)}
function dragEnd(){clearTimeout(timeout);target.style.opacity='';if(clone)clone.remove();if(target.parentNode!==origin){if(sibling){sibling.after(target)}else{origin.append(target)}}
document.removeEventListener('mousemove',dragMove);document.removeEventListener('mouseup',dragEnd)}
target=target.closest('.draggable');if(!target||!dragZone)return;origin=target.parentNode;sibling=target.previousSibling;timeout=setTimeout(dragStart,200);document.addEventListener('mouseup',dragEnd)},open:function(path,content,modifyTime,focus){if(typeof focus==='undefined'){focus=!0}
if(focus&&self.sessions[path]){return self.focus(path)}
var ext=pathinfo(path).extension;var mode=atheos.textmode.selectMode(ext);var fn=function(){var session=new EditSession(content);session.setMode('ace/mode/'+mode);session.setUndoManager(new UndoManager());session.path=path;session.serverMTime=modifyTime;self.sessions[path]=session;session.untainted=content.slice(0);if(focus){atheos.editor.setSession(session)}
self.add(path,session,focus);carbon.publish('active.open',path)};atheos.common.loadScript('components/editor/ace-editor/mode-'+mode+'.js',fn)},getSession:function(path){if(path&&!self.sessions[path])return'File path not open.';if(!path&&!atheos.editor.getActive())return'No open files.';path=path||atheos.editor.getActive().getSession().path;return self.sessions[path]},getPath:function(){try{return atheos.editor.getActive().getSession().path}catch(e){return null}},check:function(path){echo({url:atheos.controller,data:{target:'active',action:'check',path:path},settled:function(status,reply){if(status==='warning'){toast(status,reply)}}})},add:function(path,session,focus){if(focus===undefined){focus=!0}
session.status='current';if(self.isTabListOverflowed(!0)){var tab=self.tabList.find('li:first-child');self.moveTab(self.dropDownMenu,tab)}
var listItem=self.createListItem(path);self.tabList.append(listItem);session.listItem=listItem;self.updateTabDropdownVisibility();echo({url:atheos.controller,data:{target:'active',action:'add',path:path}});if(focus){self.focus(path)}},focus:function(path,direction){direction=direction||!1;self.highlightEntry(path,direction);if(path!==self.getPath()){atheos.editor.setSession(self.sessions[path]);echo({url:atheos.controller,data:{target:'active','action':'setFocus','path':path}})}
self.check(path);carbon.publish('active.focus',path)},highlightEntry:function(path,direction){direction=direction||!1;var active=self.tabList.findAll('.active');active.forEach(function(item){item.removeClass('active')});var session=self.sessions[path];var dropDown=self.dropDownMenu.find('[data-path="'+path+'"]');if(dropDown.exists()){var listItem=session.listItem;self.moveTab(self.tabList,listItem,direction);var tab;if(direction==='up'){tab=self.tabList.find('li:last-child')}else{tab=self.tabList.find('li:first-child')}
self.moveTab(self.dropDownMenu,tab,direction)}
session.listItem.addClass('active')},markChanged:function(path){self.sessions[path].status='changed';self.sessions[path].autosaved=!1;self.sessions[path].listItem.addClass('changed')},save:function(path){let session=self.getSession(path);if(isString(session))return toast('error',session);path=session.path;var content=session.getValue();var newContent=content.slice(0);carbon.publish('active.save',path);var handleSuccess=function(modifyTime){session.untainted=newContent;session.serverMTime=modifyTime;session.status='current';if(session.listItem){session.listItem.removeClass('changed')}};if(session.serverMTime&&session.untainted){atheos.workerManager.addTask({taskType:'diff',id:path,original:session.untainted,changed:newContent},function(success,patch){let type=success?'savePatch':'saveFile';atheos.filemanager[type](path,patch,handleSuccess,session.serverMTime)},self)}else{atheos.filemanager.saveFile(path,newContent,handleSuccess)}},saveAll:function(){for(var session in self.sessions){if(self.sessions[session].status==='changed'){self.save(session)}}},close:function(path){let session=self.getSession(path);if(isString(session))return toast('error',session);path=session.path;var basename=pathinfo(path).basename;if(session.status==='changed'){var dialog={banner:'Close unsaved file?',data:basename,actions:{'Save & Close':function(){carbon.publish('active.close',path);self.save(path);self.remove(path)},'Discard Changes':function(){carbon.publish('active.close',path);self.remove(path)},'Cancel':function(){}}};atheos.alert.show(dialog)}else{carbon.publish('active.close',path);self.remove(path)}},closeAll:function(){var changedTabs='';for(var path in self.sessions){if(self.sessions[path].status==='changed'){var basename=pathinfo(path).basename;changedTabs+=basename+'\n'}}
if(changedTabs!==''){var dialog={banner:'Close unsaved file?',data:changedTabs,actions:{'Save All & Close':function(){carbon.publish('active.closeAll');self.saveAll();self.removeAll()},'Discard Changes':function(){carbon.publish('active.closeAll');self.removeAll()},'Cancel':function(){}}};atheos.alert.show(dialog)}else{self.removeAll()}},remove:function(path){if(!(path in self.sessions)){return}
var session=self.sessions[path];session.listItem.remove();self.updateTabDropdownVisibility();var tabs=self.tabList.findAll('li');if(tabs.length===0){atheos.editor.exterminate()}else{var nextFocus=tabs[0].attr('data-path');var nextSession=self.sessions[nextFocus];atheos.editor.removeSession(session,nextSession);self.focus(nextFocus)}
delete self.sessions[path];echo({url:atheos.controller,data:{target:'active',action:'remove',path:path}})},removeAll:function(){for(var path in self.sessions){var session=self.sessions[path];session.listItem.remove();delete self.sessions[path]}
self.updateTabDropdownVisibility();atheos.editor.exterminate();echo({url:atheos.controller,data:{target:'active',action:'removeAll'}})},reload:function(path){if(!path&&atheos.contextmenu.active){path=atheos.contextmenu.active.path}
let session=self.getSession(path);if(isString(session))return toast('error',session);path=session.path;echo({data:{target:'filemanager',action:'open',path:path},settled:function(status,reply){if(status!=='success')return toast('error','Unable to reload file.');session.serverMTime=reply.modifyTime;session.untainted=reply.content;session.setValue(reply.content);session.status='current';if(session.listItem){session.listItem.removeClass('changed')}
toast('success','File reloaded from server.')}})},reset:function(path){if(!path&&atheos.contextmenu.active){path=atheos.contextmenu.active.path}
let session=self.getSession(path);if(isString(session))return toast('error',session);path=session.path;session.setValue(session.untainted);session.status='current';if(session.listItem){session.listItem.removeClass('changed')}
toast('success','File reset from cache.')},rename:function(oldPath,newPath){var switchSessions=function(oldPath,newPath){var listItem=self.sessions[oldPath].listItem;listItem.attr('data-path',newPath);var title=newPath;if(atheos.common.isAbsPath(newPath)){title=newPath.substring(1)}
let info=pathinfo(newPath);listItem.find('a').html(`<span class="subtle">${info.directory.replace(/^\/+/g, '')}/</span>${info.basename}`);self.sessions[newPath]=self.sessions[oldPath];self.sessions[newPath].path=newPath;delete self.sessions[oldPath]};if(self.sessions[oldPath]){switchSessions.apply(self,[oldPath,newPath]);for(var k=0;k<atheos.editor.instances.length;k++){if(atheos.editor.instances[k].getSession().path===newPath){atheos.editor.setActive(atheos.editor.instances[k])}}
var newSession=self.sessions[newPath];var ext=pathinfo(newPath).extension;var mode=atheos.textmode.selectMode(ext);var fn=function(){atheos.textmode.setModeDisplay(newSession);newSession.removeListener('changeMode',fn)};newSession.on('changeMode',fn);newSession.setMode('ace/mode/'+mode)}else{var newKey;for(var key in self.sessions){newKey=key.replace(oldPath,newPath);if(newKey!==key){switchSessions.apply(self,[key,newKey])}}}
echo({url:atheos.controller,data:{target:'active',action:'rename',path:oldPath,newPath:newPath},settled:function(status){if(status!=='success')return;carbon.publish('active.onRename',{'oldPath':oldPath,'newPath':newPath})}})},move:function(direction){var activeTabs=self.tabList.findAll('li');if(self.loopBehavior==='loopBoth'){var dropDownChildren=self.dropDownMenu.findAll('li');activeTabs=activeTabs.concat(dropDownChildren)}
var index=!1;activeTabs.forEach(function(tab,i){index=tab.hasClass('active')?i:index});if(index===!1||activeTabs.length===0){return}
var newActive=null;if(direction==='up'){index=(index===0)?(activeTabs.length-1):(index-1);newActive=activeTabs[index]}else{index=(index+1)%activeTabs.length;newActive=activeTabs[index]}
if(newActive){if(self.loopBehavior==='loopBoth'){self.focus(newActive.attr('data-path'),direction)}else{self.focus(newActive.attr('data-path'))}}},moveTab:function(destination,listItem,direction){direction=direction||!1;if(direction==='up'){destination.prepend(listItem)}else{destination.append(listItem)}},isTabListOverflowed:function(includeFictiveTab){includeFictiveTab=includeFictiveTab||!1;var tabs=self.tabList.findAll('li');var count=includeFictiveTab?tabs.length+1:tabs.length;if(count<=1){return!1}
var tabWidth=count*tabs[0].width(!0);var availableWidth=oX('#ACTIVE').width();var iconWidths=oX('#tab_dropdown').width()*2;var room=availableWidth-(iconWidths+tabWidth+50);return(room<0)},updateTabDropdownVisibility:function(){var listItem;while(self.isTabListOverflowed()){listItem=self.tabList.find('li:last-child');if(listItem.exists()){self.moveTab(self.dropDownMenu,listItem)}else{break}}
while(!self.isTabListOverflowed(!0)){listItem=self.dropDownMenu.find('li:last-child');if(listItem.exists()){self.moveTab(self.tabList,listItem)}else{break}}
if(self.dropDownMenu.findAll('li').length>0){oX('#tab_dropdown').show()}else{oX('#tab_dropdown').hide()}
if(self.tabList.findAll('li').length>1){oX('#tab_close').show()}else{oX('#tab_close').hide()}},createListItem:function(path){var info=pathinfo(path);var item='<li class="draggable" data-path="'+path+'"><a title="'+path.replace(/^\/+/g,'')+'"><span class="subtle">'+info.directory.replace(/^\/+/g,'')+'/</span>'+info.basename+'</a><i class="close fas fa-times-circle"></i></li>';item=oX(item);return item}}})(this);

//////////////////////////////////////////////////////////////////////////////80
// components/analytics/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';const self={home:null,data:null,init:function(){echo({data:{target:'analytics',action:'init'},settled:function(status,reply){if(status==='notice'){return toast(status,reply)}else if(status==='success'){self.home=reply.home;self.send(reply.data)}}})},send(data){echo({url:self.home,data})},changeOpt(value){echo({data:{target:'analytics',action:'changeOpt',enabled:value},settled:function(status,reply){toast(status,reply)}})}};carbon.subscribe('system.loadExtra',()=>self.init());atheos.analytics=self})();

//////////////////////////////////////////////////////////////////////////////80
// components/codegit/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(global){var self=null;var atheos=global.atheos;carbon.subscribe('system.loadExtra',()=>atheos.codegit.init());atheos.codegit={location:'',activeRepo:'',files:[],repoBanner:null,repoStatus:null,fileStatus:null,changesTable:null,icon:'<i class="fas fa-code-branch"></i>',init:function(){self=this;fX('#codegit menu').on('click',function(e){var target=oX(e.target);var tagName=target.tagName;if(tagName==='A'){self.showPanel(target.attr('data-panel'),self.activeRepo)}});fX('#codegit panel').on('click',function(e){var target=oX(e.target);if(target.tagName==='BUTTON'){if(target.text()==='Diff'){self.showPanel('diff',self.activeRepo,{files:[target.parent('tr').attr('data-file')]})}else if(target.text()==='Undo'){self.undo(self.activeRepo,target.parent('tr').attr('data-file'))}}});fX('#codegit_repo_banner').on('click',function(){self.showCodeGit()});carbon.subscribe('filemanager.openDir',self.showRepoStatus);carbon.subscribe('chrono.mega',self.checkRepoStatus);carbon.subscribe('active.focus',function(path){self.checkFileStatus(path)});carbon.subscribe('active.save',function(path){setTimeout(function(){self.checkFileStatus(path);self.checkRepoStatus()},50)});carbon.subscribe('active.close active.closeAll',function(){if(self.fileStatus){self.fileStatus.empty()}})},findParentRepo:function(path){let counter=0,root=oX('#project-root').attr('data-path'),target;while(path!==root){path=pathinfo(path).directory;target=oX('[data-path="'+path+'"]');if(target&&target.hasClass('repo')){return path}
if(counter>=10){break}
counter++}
return!1},showRepoStatus:function(){if(oX('#project-root').hasClass('repo')){self.addStatusElements();self.checkRepoStatus()}else{if(self.repoBanner){self.repoBanner.hide()}
if(self.fileStatus){self.fileStatus.hide()}}},showCodeGit:function(anchor){let repo=anchor?anchor.path:oX('#project-root').attr('data-path');self.activeRepo=repo;anchor=oX('#file-manager [data-path="'+repo+'"]');if(!anchor.find('i.repo-icon'))return toast('notice',i18n('git_error_noRepo'));atheos.modal.load(800,{target:'codegit',action:'codegit',repo})},showPanel:function(panel,repo,data){if(typeof(panel)==='string'){var menu=oX('menu a[data-panel="'+panel+'"]');if(menu){oX('menu .active').removeClass('active');menu.addClass('active')}
data=data||{};data.target='codegit';data.action='loadPanel';data.panel=panel;data.repo=repo;echo({url:atheos.dialog,data:data,success:function(reply){oX('panel').html(reply)}})}},showDialog:function(type,repo,path){path=path||oX('#project-root').attr('data-path');self.location=repo||self.location;atheos.modal.load(600,{target:'codegit',action:'loadPanel',panel:type,repo,path})},gitInit:function(anchor){echo({url:atheos.controller,data:{target:'codegit',action:'init',type:'repo',repo:anchor.path},settled:function(status,reply){if(status==='success'){self.addRepoIcon(anchor.path)}}})},gitClone:function(anchor){var listener=function(e){e.preventDefault();var repoURL=oX('#dialog form input[name="clone"]').value();echo({data:{target:'codegit',action:'clone',repoURL,path:anchor.path},settled:function(status,reply){toast(status,reply);if(status==='success'){self.addRepoIcon(anchor.path);atheos.filemanager.rescan(anchor.path);atheos.modal.unload()}}})};atheos.modal.load(250,{target:'codegit',action:'clone',repo:anchor.path,listener})},addRepoIcon:function(path){var node=oX('#file-manager a[data-path="'+path+'"]');node.addClass('repo');if(!node.find('i.repo-icon')){node.append('<i class="repo-icon fas fa-code-branch"></i>')}},commit:function(){var message=oX('#commit_message');var repo=self.activeRepo;var data={action:'commit',target:'codegit',files:[],message:message.value(),repo};var checkboxes=oX('#codegit_overview tbody').findAll('input[type="checkbox"]');checkboxes.forEach((checkbox)=>{if(checkbox.prop('checked')){data.files.push(checkbox.parent('tr').attr('data-file'))}});echo({url:atheos.controller,data:data,success:function(reply){toast(reply);if(reply.status!=='error'){message.empty();oX('input[type="checkbox"][group="cg_overview"][parent="true"').prop('checked',!1);checkboxes.forEach((checkbox)=>{if(checkbox.prop('checked')){checkbox.parent('tr').remove()}})}}})},checkFileStatus:function(path){path=path||atheos.active.getPath();echo({url:atheos.controller,data:{target:'codegit',action:'fileStatus',path:path},settled:function(status,reply){var text='';if(status!=='error'){text=`${self.icon}${reply.branch}: +${reply.insertions}, -${reply.deletions}`}
if(self.fileStatus){self.fileStatus.html(text)}}})},checkRepoStatus:function(){var repo=atheos.project.current.path;echo({url:atheos.controller,data:{target:'codegit',action:'repoStatus',repo},success:function(reply){var status='Unknown';if(reply.status!=='error'){status=reply.text}
if(self.repoStatus){self.repoStatus.text(i18n('codegit_'+status.toLowerCase()))}
if(self.repoBanner){self.repoBanner.replaceClass('repoCommitted repoUncommitted repoUntracked','repo'+status)}}})},diff:function(anchor){let{path,inRepo:repo}=anchor;if(!path||!repo)return;path=path.replace(repo+'/','');self.showDialog('diff',repo,path)},blame:function(anchor){let{path,inRepo:repo}=anchor;if(!path||!repo)return;path=path.replace(repo+'/','');self.showDialog('blame',repo,path)},log:function(anchor){let{path,inRepo:repo}=anchor;if(!path||!repo)return;path=path.replace(repo+'/','');self.showDialog('log',repo,path)},undo:function(repo,file){var undo=function(){echo({url:atheos.controller,data:{target:'codegit',action:'checkout',repo,file},success:function(reply){toast(reply)}})};atheos.alert.show({banner:i18n('git_undo'),message:i18n('git_undo_file',pathinfo(file).basename),actions:{'Undo Changes':undo,'Cancel':function(){}}})},transfer:function(type){var repo=self.activeRepo;var remote=oX('#git_remotes').value();var branch=oX('#git_branches').value();echo({url:atheos.controller,data:{target:'codegit',action:'transfer',type,repo,remote,branch},settled:function(status,reply){output(status,reply)}})},configure:function(type){var data={target:'codegit',action:'configure',repo:self.activeRepo,type};var name=oX('#'+type+'_name');var email=oX('#'+type+'_email');data.name=name?name.value():!1;data.email=email?email.value():!1;echo({url:atheos.controller,data,success:function(reply){log(reply)}})},addStatusElements:function(){self.repoBanner=oX('#codegit_repo_banner');self.repoStatus=oX('#codegit_repo_status');self.fileStatus=oX('#codegit_file_status');if(!self.repoBanner.exists()){oX('#file-manager').before('<div id="codegit_repo_banner">Commit Status: <span id="codegit_repo_status"></span></div>');self.repoBanner=oX('#codegit_repo_banner');self.repoStatus=oX('#codegit_repo_status')}
if(self.showRepoBanner()===!1){self.repoBanner.hide()}else{self.repoBanner.show()}
if(self.showFileStatus()===!1){self.fileStatus.empty()}},showRepoBanner:function(){var setting=storage('codegit.repoBanner');setting=setting==='disabled'?!1:!0;return setting},showFileStatus:function(){var setting=storage('codegit.fileStatus');setting=setting==='disabled'?!1:!0;return setting}}})(this);

//////////////////////////////////////////////////////////////////////////////80
// components/contextmenu/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';let menu=null;const self={fileMenu:{},tabMenu:{},projectMenu:{},active:{},init:function(){menu=oX('#contextmenu');echo({data:{target:'contextmenu',action:'loadMenus'},settled:function(status,reply){if(status!=='success')return;self.fileMenu=reply.fileMenu;self.tabMenu=reply.tabMenu;carbon.publish('contextmenu.requestItems')}});fX('#file-manager').on('contextmenu',function(e){e.preventDefault();var active=oX('#file-manager a.context-menu-active');if(active)active.removeClass('context-menu-active');var anchor=atheos.filemanager.checkAnchor(e.target);self.showFileMenu(anchor);self.show(e);menu.addClass('fm')});fX('#ACTIVE').on('contextmenu',function(e){e.preventDefault();var anchor=atheos.filemanager.checkAnchor(e.target);self.showTabMenu(anchor);self.show(e);menu.addClass('at')});fX('#contextmenu.fm').on('click',function(e){e.preventDefault();let target=oX(e.target),tagName=e.target.tagName;if(['HR','DIV'].includes(tagName))return;target=tagName==='A'?target:target.parent('A');let parts=target.attr('action').split('.'),action;for(let part of parts){action=action?action[part]:window[part]}
if(typeof action==='function'){action(self.active,target);self.hide()}});let hideTimeOut=!1;fX('#contextmenu').on('mouseout, mouseover',function(e){if(e.type==='mouseout'){hideTimeOut=setTimeout(self.hide,500)}else{clearTimeout(hideTimeOut)}})},createFileMenu:function(items){let html='';for(let item of items){html+=self.createMenuItem(item)}
self.fileMenu=`<div id="fileMenu">${html}</div>`},createMenuItem:function(item){let html='';if(item.icon&&item.action){let icon=`<i class="${item.icon}"></i>`;html=`<a action="${item.action}">${icon + item.title}</a>\n`}else{html=`<hr id="${item.title}">\n`}
return html},showFileMenu:function(anchor){if(!anchor)return;let path=anchor.attr('data-path'),type=anchor.attr('data-type'),name=anchor.find('span').html(),isRepo=!isUndefined(anchor.find('i.repo-icon')),inRepo=atheos.codegit.findParentRepo(path),extension=type==='folder'?'folder':pathinfo(path).extension;anchor.addClass('context-menu-active');let html='';for(let item of self.fileMenu){if('noRoot' in item&&type==='root')continue;if('type' in item&&item.type!==type){if(type!=='root'||item.type!=='folder')continue}
if('isRepo' in item&&item.isRepo!==isRepo)continue;if('inRepo' in item&&item.inRepo!==(inRepo!==!1))continue;if('fTypes' in item&&!item.fTypes.includes(extension))continue;html+=self.createMenuItem(item)}
menu.html(html);if(type!=='file'&&atheos.filemanager.clipboard===''){oX('#contextmenu i.fa-paste').parent().hide()}
self.active={path,type,name,isRepo,inRepo,extension};carbon.publish('contextmenu.showFileMenu',self.active)},showTabMenu:function(anchor){if(!anchor)return;anchor=anchor.parent('li');var path=anchor.attr('data-path'),type=anchor.attr('data-type'),name=anchor.find('span').html();var html='<a id="reload_file"><i class="fas fa-sync-alt"></i>Reload</a><a id="reset_file"><i class="fas fa-sync-alt"></i>Reset</a>';self.active={path,type,name};menu.attr({'data-path':path,'data-type':type,'data-name':name});menu.html(html);carbon.publish('contextmenu.showTabMenu')},show:function(e){menu.removeClass('fm at');var top=e.pageY;var windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;if(top>windowHeight-menu.height()){top-=menu.height()}
top=top<10?10:top;var max=windowHeight-top-10;menu.css({'top':top+'px','left':e.pageX+'px','max-height':max+'px','display':'block'})},hide:function(){menu.hide();self.active=!1;carbon.publish('contextmenu.hide')}};carbon.subscribe('system.loadMinor',self.init);atheos.contextmenu=self})();

//////////////////////////////////////////////////////////////////////////////80
// components/draft/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(global){'use strict';var atheos=global.atheos;var self=null;carbon.subscribe('system.loadMinor',()=>atheos.draft.init());atheos.draft={enabled:!0,interval:300000,verbose:!1,throttle:null,saving:[],init:function(){self=this;carbon.subscribe('settings.loaded, settings.save',function(){self.enabled=storage('draft.enabled')===!1?!1:self.enabled;self.verbose=storage('draft.verbose')===!0?!0:self.verbose;let interval=storage('draft.interval');interval=isNumber(interval)?interval:self.interval;if(isFunction(self.throttle)){carbon.unsubscribe('chrono.kilo',self.throttle)}
self.throttle=throttle(self.autosave,interval);carbon.subscribe('chrono.kilo',self.throttle)});carbon.subscribe('active.save',self.delete);carbon.subscribe('active.open',self.check)},autosave:function(){if(!self.enabled||self.saving.length>0)return;var changedTabs=atheos.active.unsavedChanges();if(!changedTabs)return;changedTabs.forEach(function(path){let session=atheos.active.sessions[path];if(session.autosaved)return;self.save(session)})},check:function(path){echo({data:{target:'draft',action:'check',path:path},settled:function(status,reply){if(status!=='success')return;atheos.alert.show({banner:'Draft found!',data:path,message:'Would you like to load the draft file instead?\n\n'+'Either option will delete the draft on the server.',actions:{'Load Draft':function(){self.open(path)},'Discard Draft':function(){self.delete(path)}}})}})},delete:function(path){echo({data:{target:'draft',action:'delete',path:path}})},open:function(path){let session=atheos.active.sessions[path];if(!session)return;echo({data:{target:'draft',action:'open',path:path},settled:function(status,reply){if(status!=='success')return;session.setValue(reply.content,1)}})},save:function(session){self.saving.push[session.path];let content=session.getValue();echo({data:{target:'draft',action:'save',path:session.path,content},settled:function(status,reply){if(status!=='success')return;let index=self.saving.indexOf(session.path);self.saving=self.saving.splice(index,1);session.autosaved=!0;if(self.verbose&&self.saving.length===0){atheos.toast.show('success','Autosave to draft complete.')}}})}}})(this);

//////////////////////////////////////////////////////////////////////////////80
// components/editor/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){let eStorage=(k,v)=>storage('editor.'+k,v);var VirtualRenderer=ace.require('ace/virtual_renderer').VirtualRenderer;var Editor=ace.require('ace/editor').Editor;var EditSession=ace.require('ace/edit_session').EditSession;var UndoManager=ace.require('ace/undomanager').UndoManager;var self=!1;carbon.subscribe('system.loadMajor',()=>atheos.editor.init());atheos.editor={instances:[],activeInstance:null,settings:{theme:'atheos',fontSize:'13px',fontFamily:'Ubuntu-Fira',highlightActiveLine:!0,showPrintMargin:!1,printMarginColumn:80,displayIndentGuides:!0,showFoldWidgets:!0,useWrapMode:!1,useSoftTabs:!1,tabSize:4},rootContainer:null,fileExtensionTextMode:{},init:function(){if(self)return;self=this;carbon.subscribe('settings.loaded',function(){for(let key in self.settings){let temp=eStorage(key);if(temp!==null)self.settings[key]=temp}});carbon.sub('chrono.byte',self.trackCursor);var editor=oX('#EDITOR');fX('#EDITOR').on('h-resize-root, v-resize-root',function(e){var wrapper=oX('#EDITOR .editor-wrapper');if(wrapper){if(e.type==='h-resize-root'){wrapper.css('width',editor.width());fX('#EDITOR .editor-wrapper').trigger('h-resize')}else{wrapper.css('height',editor.height());fX('#EDITOR .editor-wrapper').trigger('v-resize')}}
self.forEachInstance(function(int){int.resize()})});window.addEventListener('resize',function(){fX('#EDITOR').trigger('h-resize-root, v-resize-root')})},applySettings:function(instance){instance.setOptions({fontFamily:self.settings.fontFamily,enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0});instance.setAnimatedScroll(!0);instance.setTheme('ace/theme/'+self.settings.theme);instance.setFontSize(self.settings.fontSize);instance.setHighlightActiveLine(self.settings.highlightActiveLine);instance.setShowPrintMargin(self.settings.showPrintMargin);instance.setPrintMarginColumn(self.settings.printMarginColumn);instance.setDisplayIndentGuides(self.settings.displayIndentGuides);instance.setShowFoldWidgets(self.settings.showFoldWidgets);instance.getSession().setUseWrapMode(self.settings.useWrapMode);instance.getSession().setUseSoftTabs(self.settings.useSoftTabs);instance.getSession().setTabSize(self.settings.tabSize)},addInstance:function(session,where){var editor=oX('<div class="editor"></div>');var childID=null,splitContainer=null;if(self.instances.length===0){oX('#root-editor-wrapper').append(editor)}else{var firstChild=self.activeInstance.element;childID=(where==='top'||where==='left')?0:1;var type=(where==='top'||where==='bottom')?'vertical':'horizontal';var children=[];children[childID]=editor.element;children[1-childID]=firstChild.element;var parent=oX('<div class="editor-wrapper">');parent.css('height',firstChild.height());parent.css('width',firstChild.width());parent.addClass('editor-wrapper-'+type);firstChild.parent().append(parent);splitContainer=new SplitContainer(parent.element,children,type);if(self.instances.length>1){var pContainer=self.activeInstance.splitContainer;var idx=self.activeInstance.splitID;pContainer.setChild(idx,splitContainer)}}
var instance=ace.edit(editor.element);var resizeEditor=()=>instance.resize();if(splitContainer){instance.splitContainer=splitContainer;instance.splitID=childID;self.activeInstance.splitContainer=splitContainer;self.activeInstance.splitID=1-childID;oX(splitContainer.parent).on('h-resize',resizeEditor);oX(splitContainer.parent).on('v-resize',resizeEditor);if(self.instances.length===1){var re=function(){self.instances[0].resize()};oX(splitContainer.parent).on('h-resize',re);oX(splitContainer.parent).on('v-resize',re)}}
instance.element=editor;self.setSession(session,instance);instance.on('change',()=>atheos.active.markChanged(instance.getSession().path));self.bindKeys(instance);self.instances.push(instance);instance.on('focus',function(){self.focus(instance,!0)});return instance},exterminate:function(){var editors=oX('#EDITOR').findAll('.editor, .editor-wrapper');editors.forEach((editor)=>{editor.remove()});oX('#current_file').html('');oX('#current_mode>span').html('');self.instances=[];self.activeInstance=null},removeSession:function(session,replacementSession){for(var k=0;k<self.instances.length;k++){if(self.instances[k].getSession().path===session.path){self.instances[k].setSession(replacementSession)}}
if(oX('#current_file').text()===session.path){oX('#current_file').text(replacementSession.path)}
atheos.textmode.setModeDisplay(replacementSession)},isOpen:function(session){for(var k=0;k<self.instances.length;k++){if(self.instances[k].getSession().path===session.path){return!0}}
return!1},forEachInstance:function(fn){for(var k=0;k<self.instances.length;k++){fn.call(self,self.instances[k])}},setActive:function(instance){if(!instance)return;self.activeInstance=instance;var path=instance.getSession().path;path=(path.length<30)?path:'...'+path.substr(path.length-30);oX('#current_file').text(path);atheos.textmode.setModeDisplay(instance.getSession())},setSession:function(session,instance){instance=instance||self.activeInstance;if(!self.isOpen(session)){if(!instance){instance=self.addInstance(session)}else{instance.setSession(session)}}else{var proxySession=new EditSession(session.getDocument(),session.getMode());proxySession.setUndoManager(new UndoManager());proxySession.path=session.path;proxySession.listItem=session.listItem;proxySession.serverMTime=session.serverMTime;if(!instance){instance=self.addInstance(proxySession)}else{instance.setSession(proxySession)}}
self.applySettings(instance);self.setActive(instance)},setContent:function(c,i){i=i||self.getActive();i.getSession().setValue(c)},setTheme:function(val,int){if(int)return int.setTheme('ace/theme/'+val);self.forEachInstance(function(int){int.setTheme('ace/theme/'+val)});self.settings.theme=val;eStorage('theme',val)},setFontSize:function(val,int){if(int)return int.setFontSize(val);self.forEachInstance(function(int){int.setFontSize(val)});self.settings.fontSize=val;eStorage('fontSize',val)},setCodeLigatures:function(val,int){log(val);val=val?'Ubuntu-Fira':'Ubuntu-Mono';if(int)return int.setOption('fontFamily',val);self.forEachInstance(function(int){int.setOption('fontFamily',val)});self.settings.fontFamily=val;eStorage('fontFamily',val)},setHighlightActiveLine:function(val,int){val=(val=='true');if(int)return int.setHighlightActiveLine(val);self.forEachInstance(function(int){int.setHighlightActiveLine(val)});self.settings.highlightActiveLine=val;eStorage('highlightActiveLine',val)},setShowPrintMargin:function(val,int){val=(val=='true');if(int)return int.setShowPrintMargin(val);self.forEachInstance(function(int){int.setShowPrintMargin(val)});self.settings.showPrintMargin=val;eStorage('showPrintMargin',val)},setPrintMarginColumn:function(val,int){val=parseInt(val,10);if(int)return int.setPrintMarginColumn(val);self.forEachInstance(function(int){int.setPrintMarginColumn(val)});self.settings.printMarginColumn=val;eStorage('printMarginColumn',val)},setDisplayIndentGuides:function(val,int){val=(val=='true');if(int)return int.setDisplayIndentGuides(val);self.forEachInstance(function(int){int.setDisplayIndentGuides(val)});self.settings.displayIndentGuides=val;eStorage('displayIndentGuides',val)},setShowFoldWidgets:function(val,int){val=(val=='true');if(int)return int.setShowFoldWidgets(val);self.forEachInstance(function(int){int.setShowFoldWidgets(val)});self.settings.showFoldWidgets=val;eStorage('showFoldWidgets',val)},setUseWrapMode:function(val,int){val=(val=='true');if(int)return int.getSession().setUseWrapMode(val);self.forEachInstance(function(int){int.getSession().setUseWrapMode(val)});self.settings.useWrapMode=val;eStorage('useWrapMode',val)},setUseSoftTabs:function(val,int){val=(val=='true');if(int)return int.getSession().setUseSoftTabs(val);self.forEachInstance(function(int){int.getSession().setUseSoftTabs(val)});self.settings.useSoftTabs=val;eStorage('useSoftTabs',val)},setTabSize:function(val,int){val=parseInt(val,10);if(int)return int.getSession().setTabSize(val);self.forEachInstance(function(int){int.getSession().setTabSize(val)});self.settings.tabSize=val;eStorage('tabSize',val)},beautify:function(){var beautify=ace.require('ace/ext/beautify');var editor=self.activeInstance;beautify.beautify(editor.session)},insertText:function(val,i){i=i||self.getActive();if(!i)return;i.insert(val)},gotoLine:function(line,i){i=i||self.getActive();if(!i)return;i.scrollToLine(line,!0,!0);i.gotoLine(line,0,!0);self.focus()},focus:function(instance,dispatched){instance=instance||self.getActive();if(!instance)return;self.setActive(instance);if(!dispatched)instance.focus();atheos.active.focus(instance.getSession().path)},trackCursor:function(){var col=i18n('Col');let i=atheos.editor.getActive();if(!i)return;let pos=i.getCursorPosition();oX('#cursor-position').html(`${i18n('Ln')}: ${pos.row + 1}&middot;${i18n('Col')}: ${pos.column}`)},bindKeys:function(instance){instance.commands.addCommand({name:'Move Up',bindKey:{win:'Ctrl-up',mac:'Command-up'},exec:function(e){atheos.active.move('up')}});instance.commands.addCommand({name:'Move Down',bindKey:{win:'Ctrl-down',mac:'Command-up'},exec:function(e){atheos.active.move('down')}})},getActive:()=>self.activeInstance,getSession:(i)=>(i||self.activeInstance).getSession(),getSelection:(i)=>(i||self.activeInstance).getSelection(),getSelectedText:(i)=>(i||self.activeInstance).getCopyText(),getSelectionRange:(i)=>(i||self.activeInstance).getSelection().getRange(),getDocument:(i)=>(i||self.activeInstance).getSession().getDocument(),getContent:(i)=>(i||self.activeInstance).getSession().getValue(),}})();

//////////////////////////////////////////////////////////////////////////////80
// components/filemanager/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';const self={clipboard:'',noOpen:['jpg','jpeg','png','gif','bmp','exe','zip','tar','tar.gz'],openTrigger:'click',showHidden:!0,init:function(){self.nodeListener();let toggleHidden=oX('#fm_toggle_hidden');toggleHidden.on('click',self.toggleHidden);carbon.subscribe('settings.loaded',function(){var local=storage('filemanager.openTrigger');if(local==='click'||local==='dblclick'){self.openTrigger=local}
self.showHidden=storage('filemanager.showHidden')===!1?!1:self.showHidden;if(self.showHidden===!1){toggleHidden.switchClass('fa-eye','fa-eye-slash')}});fX('#dialog .fileRename').on('submit',self.rename);fX('#dialog .pathCreate').on('submit',self.create);fX('#dialog .pathDuplicate').on('submit',self.duplicate)},toggleHidden:function(e){let toggle=oX('#fm_toggle_hidden');toggle.switchClass('fa-eye','fa-eye-slash');self.showHidden=toggle.hasClass('fa-eye')?!0:!1;atheos.settings.save('filemanager.showHidden',self.showHidden,!0);self.rescan()},checkAnchor:function(anchor){anchor=oX(anchor);let tagName=anchor.tagName;if(tagName==='UL'){return!1}else if(tagName!=='A'){if(tagName==='LI'){anchor=anchor.find('a')}else{anchor=anchor.parent('a')}}
return anchor},nodeListener:function(){fX('#file-manager a').on('click, dblclick',function(e){if(self.openTrigger===e.type){var anchor=self.checkAnchor(e.target);if(anchor.attr('data-type')==='folder'||anchor.attr('data-type')==='root'){self.openDir(anchor.attr('data-path'))}else if(anchor.attr('data-type')==='file'){self.openFile(anchor.attr('data-path'))}}});fX('#file-manager').on('mousedown',self.handleDrag);fX('#file-manager').on('dragstart',blackhole)},handleDrag:function(e){e.stopPropagation();var target=e.target;var origin,sibling;var dragZone=oX('#file-manager').element;var clone,startEX,startEY,startMX,startMY,timeout;var xMax,yMax;function moveTarget(e){timeout=!1;var swap=[].slice.call(dragZone.querySelectorAll('.draggable'));swap=swap.filter((item)=>{var rect=item.getBoundingClientRect();if(e.clientX<rect.left||e.clientX>=rect.right)return!1;if(e.clientY<rect.top||e.clientY>=rect.bottom)return!1;return(item!==clone)});if(swap.length===0)return;swap=swap[swap.length-1];if(dragZone.contains(swap)){swap=swap!==target.nextSibling?swap:swap.nextSibling;if(swap&&!target.contains(swap)){swap.parentNode.insertBefore(target,swap)}}}
function dragMove(e){var x=startEX+e.screenX-startMX,y=startEY+e.screenY-startMY;x=(x>xMax)?xMax:((x<0)?0:x);y=(y>yMax)?yMax:((y<0)?0:y);clone.style.left=(x-dragZone.scrollLeft)+'px';clone.style.top=(y-dragZone.scrollTop)+'px';if(timeout===!1){timeout=setTimeout(()=>moveTarget(e),50)}}
function dragStart(){timeout=!1;startEX=target.offsetLeft;startEY=target.offsetTop;startMX=e.screenX;startMY=e.screenY;clone=target.cloneNode(!0);let UL=clone.querySelector('UL');if(UL)UL.remove();clone.style.left=(startEX-dragZone.scrollLeft)+'px';clone.style.top=(startEY-dragZone.scrollTop)+'px';clone.style.position='absolute';clone.style.cursor='grabbing';dragZone.append(clone);target.style.opacity=0.5;xMax=dragZone.offsetWidth-clone.offsetWidth;yMax=dragZone.offsetHeight-clone.offsetHeight;document.addEventListener('mousemove',dragMove)}
function dragEnd(){document.removeEventListener('mousemove',dragMove);document.removeEventListener('mouseup',dragEnd);if(timeout){return clearTimeout(timeout)}
target.style.opacity='';if(clone)clone.remove();let parent=target.closest('ul');let folder=parent.previousSibling;setTimeout(()=>self.sortNodes(parent),10);if(parent===origin||!folder)return origin.append(target);self.handleDrop(target,folder)}
target=target.closest('.draggable');if(!target||!dragZone)return;origin=target.parentNode;sibling=target.previousSibling;timeout=setTimeout(dragStart,250);document.addEventListener('mouseup',dragEnd)},handleDrop:function(node,dest){node=oX(node).find('a[data-path');dest=oX(dest);let oldPath=node.attr('data-path'),parPath=dest.attr('data-path'),newPath=parPath+'/'+pathinfo(oldPath).basename;if(oX('#file-manager a[data-path="'+newPath+'"]').exists()){toast('warning','Path already exists.')}else{echo({data:{target:'filemanager',action:'move',path:oldPath,dest:newPath},settled:function(status,reply){if(status!=='success'){self.rescan();toast('error',reply)}else{node.attr('data-path',newPath);atheos.active.rename(oldPath,newPath)}}})}},openDir:function(path,rescan){var slideDuration=200;rescan=rescan||!1;var node=oX('#file-manager a[data-path="'+CSS.escape(path)+'"]');if(!node.exists())return;let icon=node.find('.expand');if(node.hasClass('open')&&!rescan){node.removeClass('open');var list=node.siblings('ul')[0];if(list){atheos.flow.slide('close',list.element,slideDuration);if(icon){icon.replaceClass('fa-minus','fa-plus')}
setTimeout(function(){list.remove()},slideDuration)}}else{if(icon.exists()){icon.addClass('loading')}
echo({data:{target:'filemanager',action:'index',path},settled:function(status,reply){if(status!=='error'){var files=reply.index;if(files&&files.length>0){if(icon.exists()){icon.replaceClass('fa-plus','fa-minus')}
var display=' style="display:none;"';if(rescan){display=''}
var appendage='<ul'+display+'>';files.forEach(function(file){appendage+=self.createDirectoryItem(file.path,file.type,file.size,file.repo);if(pathinfo(file.path).basename==='.git'){atheos.codegit.addRepoIcon(path)}});appendage+='</ul>';if(rescan&&node.siblings('ul').length>0){node.siblings('ul')[0].remove()}
node.after(appendage);var list=node.siblings('ul')[0];if(!rescan&&list){atheos.flow.slide('open',list.element,slideDuration)}}
carbon.publish('filemanager.openDir',{files:files,node:node,path:path})}
node.addClass('open');if(icon){icon.removeClass('loading');icon.replaceClass('fa-plus','fa-minus')}
if(rescan&&self.rescanChildren.length>self.rescanCounter){self.rescan(self.rescanChildren[self.rescanCounter++])}else{self.rescanChildren=[];self.rescanCounter=0}}})}},createDirectoryItem:function(path,type,size,repo){var basename=pathinfo(path).basename;if(self.showHidden===!1&&basename.charAt(0)==='.'){return''}
var fileClass=type==='folder'?'fa fa-folder blue':icons.getClassWithColor(basename);var nodeClass='none';if(type==='folder'&&(size>0)){nodeClass='fa fa-plus'}
fileClass=fileClass||'fa fa-file green';var repoIcon=repo?'<i class="repo-icon fas fa-code-branch"></i>':'';return `<li class="draggable">
			<a data-type="${type}" data-path="${path}">
			<i class="expand ${nodeClass}"></i>
			<i class="${fileClass}"></i>
			${repoIcon}
			<span>${basename}</span>
			</a>
			</li>`},rescanChildren:[],rescanCounter:0,rescan:function(anchor){let path=isObject(anchor)?anchor.path:anchor;path=path||oX('#project-root').attr('data-path');if(self.rescanCounter===0){var list=oX('#file-manager a[data-path="'+path+'"]').siblings('ul')[0];var openNodes=list.findAll('a.open');for(var i=0;i<openNodes.length;i++){self.rescanChildren.push(openNodes[i].attr('data-path'))}}
self.openDir(path,!0)},openFile:function(path,focus,line){focus=typeof(focus)!=='undefined'?focus:!0;var ext=pathinfo(path).extension.toLowerCase();if(self.noOpen.indexOf(ext)>-1)return;echo({data:{target:'filemanager',action:'open',path:path},settled:function(status,reply){if(status!=='success')return;atheos.active.open(path,reply.content,reply.modifyTime,focus);if(line)setTimeout(atheos.editor.gotoLine(line),500)}})},saveModifications:function(path,data,callback){data.target='filemanager';data.action='save';data.path=path;echo({data:data,settled:function(status,reply){if(status==='success'){toast('success','File saved');if(typeof callback==='function'){callback.call(self,reply.modifyTime)}}else if(reply.text==='out of sync'){atheos.alert.show({banner:'File changed on server!',message:'Would you like to load the updated file?\n'+'Pressing no will cause your changes to override the\n'+'server\'s copy upon next save.',actions:{'Reload File':function(){atheos.active.remove(path);self.openFile(path)},'Save Anyway':function(){var session=atheos.editor.getActive().getSession();session.serverMTime=null;session.untainted=null;atheos.active.save()}}})}else{toast('error','File could not be saved')}}})},saveFile:function(path,content,callback){self.saveModifications(path,{content},callback)},savePatch:function(path,patch,callback,modifyTime){if(patch.length>0){self.saveModifications(path,{patch,modifyTime},callback)}else if(typeof callback==='function'){callback.call(self,modifyTime)}},copy:function(anchor){self.clipboard=anchor.path;toast('success','Copied to Clipboard')},paste:function(anchor){let path=anchor.path,split=pathinfo(self.clipboard),copy=split.basename,type=split.type;var processPaste=function(path,duplicate){if(duplicate){copy='copy_'+copy}
echo({data:{target:'filemanager',action:'duplicate',path:self.clipboard,dest:path+'/'+copy},settled:function(status,reply){if(status!=='error'){self.addToFileManager(path+'/'+copy,type,path);carbon.publish('filemanager.paste',{path:path,dest:copy})}}})};if(self.clipboard===''){toast('error','Nothing in Your Clipboard')}else if(path===self.clipboard){toast('error','Cannot Paste Directory Into Itself')}else if(oX('#file-manager a[data-path="'+path+'/'+copy+'"]').exists()){atheos.alert.show({banner:'Path already exists!',message:'Would you like to overwrite or duplicate the file?',data:`${path}/${copy}`,actions:{'Overwrite':function(){processPaste(path,!1)},'Duplicate':function(){processPaste(path,!0)}}})}else{processPaste(path,!1)}},openDuplicate:function(anchor){let split=pathinfo(anchor.path),name=split.basename,type=split.type;self.activeAnchor=anchor;atheos.modal.load(250,{target:'filemanager',action:'duplicate',name,type})},duplicate:function(e){e.preventDefault();let path=self.activeAnchor.path,split=pathinfo(path),name=split.basename,type=split.type;var clone=oX('#dialog form input[name="clone"]').value();var parent=path.split('/').slice(0,-1).join('/');var clonePath=parent+'/'+clone;echo({data:{target:'filemanager',action:'duplicate',path:path,dest:clonePath},settled:function(status,reply){toast(status,reply);if(status==='success'){self.addToFileManager(clonePath,type,parent);atheos.modal.unload();carbon.publish('filemanager.duplicate',{sourcePath:path,clonePath:clonePath,type:type})}}});atheos.modal.unload()},activeAnchor:{},create:function(e){e.preventDefault();let name=oX('#dialog form input[name="nodeName"]').value(),path=self.activeAnchor.path+'/'+name,type=self.activeAnchor.type;echo({data:{target:'filemanager',action:'create',path,type},settled:function(status,reply){if(status!=='success')return toast(status,reply);toast('success','File Created');atheos.modal.unload();self.addToFileManager(path,type,self.activeAnchor.path);if(type==='file'){self.openFile(path,!0)}
carbon.publish('filemanager.create',{type,path,name})}})},addToFileManager:function(path,type,parent){var parentNode=oX('#file-manager a[data-path="'+parent+'"]');log('addToFileManager');if(oX('#file-manager a[data-path="'+path+'"]').exists())return;if(parentNode.hasClass('open')&&parentNode.attr('data-type').match(/^(folder|root)$/)){var node=self.createDirectoryItem(path,type,0);var list=parentNode.siblings('ul')[0];if(list){list.append(node);self.sortNodes(list.element)}else{list=oX('<ul>');list.append(node);parentNode.append(list.element)}}else{if(parentNode.find('.expand')){parentNode.find('.expand').replaceClass('none','fa fa-plus')}}},sortNodes:function(list){var children=[...list.children];children=children.map(function(node){return{node:node,span:node.querySelector('span').textContent,type:node.querySelector('a').getAttribute('data-type')}});children.sort(function(a,b){return a.span.localeCompare(b.span)});children.reverse();children.sort(function(a,b){return a.type.localeCompare(b.type)});children.reverse();children.forEach(function(item){list.appendChild(item.node)})},openRename:function(anchor){self.activeAnchor=anchor;atheos.modal.load(250,{target:'filemanager',action:'rename',name:anchor.name,type:anchor.type})},createFile:function(anchor){self.openCreate(anchor,'file')},createFolder:function(anchor){self.openCreate(anchor,'folder')},openCreate:function(anchor,type){anchor.type=type;self.activeAnchor=anchor;atheos.modal.load(250,{target:'filemanager',action:'create',type:type})},rename:function(e){e.preventDefault();let path=self.activeAnchor.path,name=self.activeAnchor.name,type=self.activeAnchor.type;var newName=oX('#dialog form input[name="name"]').value();var arr=path.split('/');var temp=[];for(var i=0;i<arr.length-1;i++){temp.push(arr[i])}
var newPath=temp.join('/')+'/'+newName;echo({data:{target:'filemanager',action:'rename',path:path,name:newName},settled:function(status,reply){if(status!=='success')return;if(type==='file'){toast('success','File Renamed.')}else{toast('success','Folder Renamed.')}
var node=oX('#file-manager a[data-path="'+path+'"]'),icon=node.find('i:nth-child(2)'),span=node.find('span');node.attr('data-path',newPath);span.text(newName);if(type==='file'){icon.removeClass();var ico=icons.getClassWithColor(newName);if(ico){icon.addClass(icons.getClassWithColor(newName))}}else{self.repathChildren(path,newPath)}
atheos.active.rename(path,newPath)}});atheos.modal.unload()},repathChildren:function(oldPath,newPath){var node=oX('#file-manager a[data-path="'+newPath+'"]'),ul=node.element.nextElementSibling;if(!ul)return;var children=ul.querySelectorAll('a');for(var i=0;i<children.length;i++){var path=children[i].getAttribute('data-path');path=path.replace(oldPath,newPath);children[i].setAttribute('data-path',path)}},delete:function(anchor){let path=anchor.path;atheos.alert.show({message:'Are you sure you wish to delete the following:',data:anchor.name,actions:{'Delete':function(){echo({data:{target:'filemanager',action:'delete',path},settled:function(status,reply){if(status!=='success')return;var node=oX('#file-manager a[data-path="'+path+'"]');node.parent('li').remove();atheos.active.remove(path)}})},'Cancel':function(){}}})}};carbon.subscribe('system.loadMajor',()=>self.init());atheos.filemanager=self})();

//////////////////////////////////////////////////////////////////////////////80
// components/install/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';var self=!1;atheos.install={init:function(){fX('#retest').on('click',()=>window.location.reload());if(self)return;self=this;let form=oX('#install');if(!form)return;let timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,option=oX('select[name="timezone"] option[value="'+timezone+'"]');if(option)option.attr('selected','selected');form.on('submit',self.checkForm)},checkForm:function(e){e.preventDefault();let fData=serialize(e.target);let vUser=!(/^[^A-Za-z0-9\-\_\@\.]+$/i.test(fData.username))&&fData.username.length!==0,vPass=fData.password===fData.validate;if(!vUser)return toast('error','Username must be an alphanumeric string');if(!vPass)return toast('error','Passwords do not match.');if(fData.projectName.length===0)return toast('error','Missing Project Name.');if(fData.projectPath.length===0)return toast('error','Missing Project Path.');if(fData.projectPath.indexOf('/')===0){let dialog={banner:'Do you really want to create project with an absolute path?',data:fData.projectPath,actions:{'Yes':function(){self.install(fData)},'No':function(){}}};atheos.alert.show(dialog)}else{self.install(fData)}},install:function(data){echo({url:'components/install/process.php',data,settled:function(status,reply){log(status,reply);if(status==='success'){setTimeout(()=>window.location.reload(),100);toast(status,reply)}else{var dialog={banner:'An error occurred:',data:reply.text,actions:{'Okay':function(){}}};atheos.alert.show(dialog)}}})},}})();

//////////////////////////////////////////////////////////////////////////////80
// components/macro/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';let hr={title:'macro',type:'file',fTypes:[]};const self={macros:[],init:function(){self.load();fX('#macro_editor').on('click',function(e){let target=oX(e.target);if(target.tagName!=='A')return;e.preventDefault();let parent=target.parent('TR');if(target.hasClass('fa-save')){self.save(parent)}else{self.delete(parent)}});fX('#macro_editor').on('change',function(e){let target=oX(e.target);if(target.tagName!=='INPUT'||target.type!=='radio')return;e.preventDefault();log(e.target);let parent=target.parent('TR'),fTypeInput=parent.find('input[name="fTypes"]');if(target.value()==="file"){fTypeInput.prop('disabled',!1)}else{fTypeInput.prop('disabled',!0)}});carbon.sub('contextmenu.showFileMenu',self.showMenu)},showMenu:function(active){let menu=oX('#contextmenu'),ext=active.extension,hrMade=!1,macro=null;for(var i in self.macros){if(!self.macros.hasOwnProperty(i))continue;macro=extend({},self.macros[i]);if(active.type!==macro.type)continue;if(macro.type==='file'&&!macro.fTypes.includes(ext))continue;macro.action="atheos.macro.execute";if(!hrMade){hrMade=!0;menu.append(self.createMenuItem(hr))}
menu.append(self.createMenuItem(macro))}},createMenuItem:function(item){let html='';if(item.icon&&item.action){let icon=`<i class="${item.icon}"></i>`;html=`<a uuid="${item.uuid}" action="${item.action}">${icon + item.title}</a>\n`}else{html=`<hr id="${item.title}">\n`}
return html},execute:function(anchor,item){let path=anchor.path,uuid=item.attr('uuid'),i=self.findMacro(uuid);if(!i)return;let macro=self.macros[i];echo({data:{target:'macro',action:'execute',uuid:macro.uuid,path},settled:function(status,reply){log(status,reply);output(status,reply);if(status!=='success')return}})},save:function(parent){let macro={uuid:parent.attr('id'),icon:"fas fa-magic",title:parent.find('input[name="title"]').value(),type:parent.find('input:checked').value(),fTypes:parent.find('input[name="fTypes"]').value(),command:parent.find('input[name="command"]').value()};macro.fTypes=macro.type==='file'?macro.fTypes:'N/A';macro.target='macro';macro.action='save';echo({data:macro,settled:function(status,reply){toast(status,reply);if(status!=='success')return;let index=self.findMacro(macro.uuid);macro.fTypes=macro.fTypes.split(',');if(index){self.macros[index]=macro}else{self.macros[Object.keys(self.macros).length]=macro}}})},delete:function(parent){let uuid=parent.attr('id');echo({data:{target:'macro',action:'delete',uuid,},settled:function(status,reply){toast(status,reply);if(status!=='success')return;let index=self.findMacro(uuid),row=oX('#'+uuid);if(index)delete self.macros[index];if(row){row.remove()}}})},findMacro:function(uuid){for(var i in self.macros){if(!self.macros.hasOwnProperty(i))continue;if(uuid===self.macros[i].uuid)return i}
return!1},load:function(){echo({data:{target:'macro',action:'load',},settled:function(status,reply){if(status!=='success')return;self.macros=reply}})},showMacro:function(){atheos.modal.load(750,{target:'macro',action:'openDialog'})},addRow:function(){let table=oX('#macro_editor');if(!table)return;let id=genID('macro');let row=`<tr id="${id}">`;row+='<td><input type="text" name="title"></input></td>';row+=`<td><toggle>
				<input id="typeFile_${id}" value="file" name="type" type="radio" checked/>
				<label for="typeFile_${id}">${i18n("file")}</label>
				<input id="typeFolder_${id}" value="folder" name="type" type="radio"/>
				<label for="typeFolder_${id}">${i18n("folder")}</label>
				</toggle></td>`;row+='<td><input type="text" name="fTypes"></input></td>';row+='<td><input type="text" name="command"></input></td>';row+='<td><a class="fas fa-save"></a><a class="fas fa-times-circle"></a></td>';row+='</tr>';table.find('tbody').append(row)}};carbon.subscribe('system.loadMinor',()=>self.init());atheos.macro=self})();

//////////////////////////////////////////////////////////////////////////////80
// components/market/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(global){'use strict';var atheos=global.atheos;carbon.subscribe('system.loadMinor',()=>atheos.market.init());var self=null;atheos.market={market:null,cache:null,init:function(){self=this;echo({data:{target:'market',action:'init'},settled:function(status,reply){if(status!=='success')return;self.market=reply.market;if(reply.request){self.loadMarket()}}})},loadMarket:function(){echo({url:self.market,settled:function(success,reply){self.saveCache(reply)}})},saveCache:function(cache){echo({data:{target:'market',action:'saveCache',cache:JSON.stringify(cache)}})},list:function(type,note){var callback=function(){atheos.modal.resize()};atheos.modal.load(960,{target:'market',action:'list',type:type,note:note,callback})},search:function(e,query,note){var key=e.charCode||e.keyCode||e.which;if(query!==''&&key===13){atheos.modal.load(800,{target:'market',action:'list',query:query,note:note})}},install:function(name,type,category){atheos.modal.setLoadingScreen('Installing '+name+'...');echo({data:{target:'market',action:'install',name,type,category},settled:function(status,reply){atheos.toast.show(status,reply);atheos.market.list()}})},remove:function(name,type,category){atheos.modal.setLoadingScreen('Deleting '+name+'...');echo({data:{target:'market',action:'remove',name,type},settled:function(status,reply){atheos.toast.show(status,reply);atheos.market.list()}})},update:function(name,type,category){atheos.modal.setLoadingScreen('Updating '+name+'...');echo({data:{target:'market',action:'update',name,type,category},settled:function(status,reply){atheos.toast.show(reply);atheos.market.list()}})},}})(this);

//////////////////////////////////////////////////////////////////////////////80
// components/project/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(global){var atheos=global.atheos;var self=null;carbon.subscribe('system.loadMinor',()=>atheos.project.init());atheos.project={sideExpanded:!0,openTrigger:'click',current:{name:'',path:''},init:function(){self=this;self.load();self.dock.load();fX('#project-atheos').on('click',function(){self.open('Atheos IDE','@TH305')});fX('#projects-create').on('click',self.create);fX('#projects-manage').on('click',self.list);fX('#projects-collapse').on('click',function(){if(self.sideExpanded){self.dock.collapse();atheos.settings.save('project.dockOpen',!1,!0);storage('project.dockOpen',!1)}else{self.dock.expand();atheos.settings.save('project.dockOpen',!0,!0);storage('project.dockOpen',!0)}});carbon.subscribe('chrono.mega',function(){self.getCurrent()});carbon.subscribe('settings.loaded',function(){var local=storage('project.openTrigger');if(local==='click'||local==='dblclick'){self.openTrigger=local}
if(storage('project.dockOpen')===!1){self.dock.collapse()}});fX('#project_list .content li').on('click, dblclick',function(e){if(self.openTrigger===e.type){var node=oX(e.target);if(node.tagName==='UL'){return!1}else if(node.tagName!=='LI'){node=node.parent()}
self.open(node.text(),node.attr('data-project'))}})},load:function(){echo({url:atheos.controller,data:{target:'project',action:'load'},settled:function(status,reply){atheos.toast.show(reply);if(status==='error')return;var logSpan=oX('#last_login');if(reply.lastLogin&&logSpan){logSpan.find('span').text(reply.lastLogin)}
self.setRoot(reply.name,reply.path,reply.repo)}})},open:function(projectName,projectPath){atheos.scout.exitFilter();echo({url:atheos.controller,data:{target:'project',action:'open',projectName,projectPath},settled:function(status,reply){atheos.toast.show(reply);if(status==='error')return;self.setRoot(reply.name,reply.path,reply.repo);if(atheos.modal.modalVisible){atheos.modal.unload()}
atheos.user.saveActiveProject(reply.name,reply.path);localStorage.removeItem('lastSearched');carbon.publish('project.open',reply.path)}})},setRoot:function(name,path,repo){self.current={name,path};oX('#file-manager').empty();let repoIcon=repo?'<i class="repo-icon fas fa-code-branch"></i>':'';oX('#file-manager').html(`<ul>
				<li>
					<a id="project-root" data-type="root" data-path="${path}">
						${repoIcon}
						<i class="root fa fa-folder blue"></i>
						<span>${name}</span>
					</a>
					<ul></ul>
				</li>
			</ul>`);atheos.filemanager.openDir(path)},list:function(){atheos.modal.load(500,{target:'project',action:'list'})},dock:{load:function(){echo({url:atheos.dialog,data:{target:'project',action:'projectDock'},success:function(reply){oX('#project_list .content').html(reply);let projects=oX('#project_list .content').findAll('LI');if(projects.length<2){self.dock.collapse()}}})},expand:function(){self.sideExpanded=!0;oX('#SBLEFT #project_list').css('height','');oX('#SBLEFT>.content').css('bottom','');oX('#projects-collapse').replaceClass('fa-chevron-circle-up','fa-chevron-circle-down')},collapse:function(){self.sideExpanded=!1;var height=oX('#SBLEFT #project_list .title').height();oX('#SBLEFT #project_list').css('height',height+'px');oX('#SBLEFT>.content').css('bottom',height+'px');oX('#projects-collapse').replaceClass('fa-chevron-circle-down','fa-chevron-circle-up')}},create:function(){var projectName,projectPath,gitRepo,gitBranch;var createProject=function(){var data={target:'project',action:'create',projectName,projectPath,gitRepo,gitBranch};echo({url:atheos.controller,data,success:function(reply){if(reply.status!=='error'){self.open(reply.name,reply.path);self.dock.load();delete data.action;carbon.publish('project.create',data)}}})};var listener=function(e){e.preventDefault();projectName=oX('#dialog form input[name="projectName"]').value();projectPath=oX('#dialog form input[name="projectPath"]').value();gitRepo=oX('#dialog form input[name="gitRepo"]').value();gitBranch=oX('#dialog form input[name="gitBranch"]').value();if(projectPath.indexOf('/')===0){atheos.alert.show({banner:'Do you really want to create a project with an absolute path?',data:projectPath,actions:{'Yes':function(){createProject()},'No':function(){}}})}else{createProject()}};atheos.modal.load(400,{target:'project',action:'create',listener,callback:function(){fX('#show_git_options').on('click',function(e){e.preventDefault();oX(e.target).hide();atheos.flow.slide('open',oX('#git_options').element)})}})},rename:function(oldName,projectPath){var listener=function(e){e.preventDefault();var newName=oX('#dialog form input[name="projectName"]').value();var data={target:'project',action:'rename',projectPath,oldName,newName};echo({url:atheos.controller,data,settled:function(status,reply){if(status!=='error'){atheos.toast.show('success','Project renamed');self.dock.load();atheos.modal.unload();delete data.action;carbon.publish('project.rename',data)}}})};atheos.modal.load(400,{target:'project',action:'rename',name:oldName,listener})},delete:function(projectName,projectPath){var listener=function(e){e.preventDefault();var scope=oX('input[name="scope"]:checked').value();echo({url:atheos.controller,data:{target:'project',action:'delete',scope,projectPath,projectName},settled:function(status,reply){if(status==='success'){atheos.toast.show('success',reply.text);self.list();self.dock.load();for(var path in atheos.active.sessions){if(path.indexOf(projectPath)===0){atheos.active.remove(path)}}
carbon.publish('project.delete',{'path':projectPath,'name':projectName})}}})};atheos.modal.load(400,{target:'project',action:'delete',name:projectName,path:projectPath,listener})},getCurrent:function(){echo({url:atheos.controller,data:{target:'project',action:'current'},success:function(data){if(data.status==='success'){self.current.path=data.path}}});return self.current.path}}})(this);

//////////////////////////////////////////////////////////////////////////////80
// components/scout/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';const self={cachedFileTree:null,rootPath:null,rootName:null,strategy:'left_prefix',init:function(){fX('#search_open').on('click',self.openSearch);fX('#filter_open').on('click',self.openFilter);fX('#filter_exit').on('click',self.exitFilter);atheos.common.initMenuHandler('#filter_options','#filter_strategy');var strategyMenu=oX('#filter_strategy');fX('#filter_strategy').on('click',function(e){var node=oX(e.target);strategyMenu.find('.active').removeClass('active');if(e.target.tagname==='A'){self.strategy=node.attr('data-option');node.parent().addClass('active')}});var changeTimeout=!1;fX('#filter_input').on('change, keydown, paste, input',function(){if(changeTimeout!==!1){clearTimeout(changeTimeout)}
changeTimeout=setTimeout(function(){self.filterTree();changeTimeout=!1},500)});fX('#dialog .searchText').on('submit',self.searchText)},searchText:function(e){e.preventDefault();var table=oX('#probe_results');oX('#probe_processing').show();var query=oX('#dialog input[name="probe_query"]').value();var extensions=oX('#dialog input[name="probe_filter"]').value();var filter=extensions.trim();if(filter!==''){filter='\\('+filter.replace(/\s+/g,'\\|')+'\\)'}
echo({url:atheos.controller,data:{target:'scout',action:'probe',path:atheos.project.current.path,query,filter},settled:function(status,reply){table.empty();oX('#probe_processing').hide();var results='';if(status==='error'){table.append('<p>'+reply.text+'</p>');return}
for(var key in reply){var file=reply[key];if(key.substr(-1)==='/'){key=key.substr(0,key.substr.length-1)}
var node=oX('<div>'),content='<span><strong>File: </strong>'+key+'</span>';node.addClass('file');file.forEach(function(result){content+=`<a class="result" onclick="atheos.filemanager.openFile('${result.path}',true,${result.line});atheos.modal.unload();"><span>Line ${result.line}: </span>${result.string}</a>`});node.html(content);table.append(node)}
results=table.html();atheos.flow.slide('open',table.element);self.saveSearchResults(query,extensions,results);atheos.modal.resize()}})},openSearch:function(){atheos.modal.load(500,{target:'scout',action:'probe',callback:function(){var table=oX('#probe_results');var lastSearched=JSON.parse(storage('lastSearched'));if(lastSearched){oX('#dialog input[name="probe_query"]').value(lastSearched.query);oX('#dialog input[name="probe_filter"]').value(lastSearched.extensions);if(lastSearched.results!==''){table.html(lastSearched.results);atheos.flow.slide('open',table.element);atheos.modal.resize()}}}})},saveSearchResults:function(query,extensions,results){var lastSearched={query,extensions,results,};storage('lastSearched',JSON.stringify(lastSearched))},openFilter:function(){self.cachedFileTree=oX('#file-manager').html();self.rootPath=oX('#project-root').attr('data-path');self.rootName=oX('#project-root span').text();self.currentlyFiltering=null;oX('#filter_wrapper').show();oX('#filter_input').focus()},exitFilter:function(){oX('#filter_wrapper').hide();if(self.cachedFileTree){oX('#file-manager').html(self.cachedFileTree);self.cachedFileTree=null}
oX('#filter_input').empty()},filterTree:function(){var input=oX('#filter_input').value();input=input.replace(/^\s+|\s+$/g,'');if(!input||input===self.currentlyFiltering){return}
self.currentlyFiltering=input;echo({url:atheos.controller,data:{target:'scout',action:'filter',filter:input,path:self.rootPath,strategy:self.strategy},success:function(reply){if(reply.status==='success'){delete reply.status;var domTree=self.createHierarchy(reply);oX('#project-root').siblings('ul')[0].html(domTree)}else{var notice='<ul><li><a><i class="fas fa-info-circle medium-blue"></i><span>No Results.</span></a></li</ul>';oX('#project-root').siblings('ul')[0].html(notice)}}})},createHierarchy:function(data){var tree={},pathArray=[],currentLevel={},key;for(key in data){var result=data[key],path=result.path,type=result.type;currentLevel=tree;if(atheos.common.isAbsPath(path)){pathArray=path.replace(this.rootPath,this.rootName).split('/')}else{pathArray=path.split('/')}
pathArray.forEach(function(fragment,index){if(fragment===''){return}
if(!currentLevel[fragment]){type=index<(pathArray.length-1)?'folder':result.type;currentLevel[fragment]={type:type,children:{}};if(type==='file'){currentLevel[fragment].path=path}else{if(atheos.common.isAbsPath(path)){currentLevel[fragment].path=pathArray.slice(0,index+1).join('/').replace(this.rootName,this.rootPath)}else{currentLevel[fragment].path=pathArray.slice(0,index+1).join('/')}}}
currentLevel=currentLevel[fragment].children})}
var domTree='<ul>';for(key in tree){var obj=tree[key];domTree+=this.createDirectoryItem(`${self.rootPath}/${obj.path}`,obj.type,obj.size)}
for(key in tree){domTree+=this.createDirectoryItem(key,tree[key])}
domTree+='</ul>';return domTree},createDirectoryItem:function(name,obj){var fileClass=obj.type==='folder'?'fa fa-folder medium-blue':icons.getClassWithColor(name);var nodeClass='none';var isOpen='';if(obj.type==='folder'&&(obj.children)){nodeClass='fa fa-minus';isOpen='class="open"'}
fileClass=fileClass||'fa fa-file medium-green';var node='<li>';node+=`<a data-type="${obj.type}" data-path="${self.rootPath}/${obj.path}" ${isOpen}>
						<i class="expand ${nodeClass}"></i>
						<i class="${fileClass}"></i>
						<span>${name}</span>
					</a>`;if(obj.children){node+='<ul>';for(var key in obj.children){node+=this.createDirectoryItem(key,obj.children[key])}
node+='</ul>'}
node+='</li>';return node}};carbon.subscribe('system.loadExtra',()=>self.init());atheos.scout=self})();

//////////////////////////////////////////////////////////////////////////////80
// components/settings/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';const self={init:function(){echo({url:atheos.controller,data:{target:'settings',action:'load',},settled:function(status,reply){if(status==='success'){for(var key in reply){storage(key,reply[key])}}
carbon.publish('settings.loaded',reply)}});fX('#dialog .settings').on('change',function(e){var target=oX(e.target);var tagName=target.tagName;var type=target.type;var key=target.attr('data-setting'),value;if(tagName==='SELECT'){value=target.value()}else if(tagName==='INPUT'&&type==='checkbox'){value=target.prop('checked')}else if(tagName==='INPUT'&&type==='radio'){value=target.value()}else{return}
if(key==='analytics.enabled'){atheos.analytics.changeOpt(value)}else{storage(key,value);self.save(key,value);self.publish(key,value)}});fX('#dialog .settings menu').on('click',function(e){var target=oX(e.target);var tagName=target.tagName;if(tagName==='A'){self.showTab(target)}})},loadTabValues:function(){var children=oX('.settings panel').findAll('[data-setting]');children.forEach(function(child){var key=oX(child).attr('data-setting'),type=child.type,value=storage(key);if(value===null){return}
if(type==='radio'){if(child.value()===value.toString()){child.prop('checked',!0)}}else if(type==='checkbox'){child.prop('checked',value)}else{child.value(value)}})},publish:function(setting,value){var boolean=(value==='true');if(value===null){return toast('alert','You must choose a value')}
switch(setting){case 'active.loopBehavior':atheos.active.loopBehavior=value;break;case 'editor.theme':atheos.editor.setTheme(value);break;case 'editor.fontSize':atheos.editor.setFontSize(value);break;case 'editor.ligatures':atheos.editor.setCodeLigatures(boolean);break;case 'editor.highlightActiveLine':atheos.editor.setHighlightActiveLine(value);break;case 'editor.showPrintMargin':atheos.editor.setShowPrintMargin(value);break;case 'editor.printMarginColumn':atheos.editor.setPrintMarginColumn(value);break;case 'editor.displayIndentGuides':atheos.editor.setDisplayIndentGuides(value);break;case 'editor.showFoldWidgets':atheos.editor.setShowFoldWidgets(value);break;case 'editor.useWrapMode':atheos.editor.setUseWrapMode(value);break;case 'editor.useSoftTabs':atheos.editor.setUseSoftTabs(value);break;case 'editor.tabSize':atheos.editor.setTabSize(value);break;case 'filemanager.showHidden':if(atheos.filemanager.showHidden!==boolean){atheos.filemanager.showHidden=boolean;atheos.filemanager.rescan()}
break;case 'filemanager.openTrigger':atheos.filemanager.openTrigger=value;break;case 'project.openTrigger':atheos.project.openTrigger=value;break;case 'sidebars.leftTrigger':atheos.sidebars.sbLeft.trigger=value;break;case 'sidebars.rightTrigger':atheos.sidebars.sbRight.trigger=value;break;case 'toast.location':atheos.toast.setLocation(value);break;case 'output.location':atheos.output.setLocation(value);break}
value=isNumber(value)?parseInt(value,10):value;if(setting.includes('toast.stay')){let key=setting.split('.').pop();atheos.toast.stayTimes[key]=value}
if(setting.includes('output.stay')){let key=setting.split('.').pop();atheos.output.stayTimes[key]=value}},save:function(key,value,hidden){if(!key||(typeof(value)==='undefined')){return}
echo({url:atheos.controller,data:{target:'settings',action:'save',key,value},settled:function(status,reply){if(status!=='success')toast(status,reply);if(hidden)return;toast(status,'Setting "'+key+'" saved.')}});carbon.publish('settings.save')},saveAll:function(key,value,hidden){var children=oX('.settings panel').findAll('[data-setting]');children.forEach(function(child){var key=oX(child).attr('data-setting'),value=storage(key);if(value===null){return}
if(child.type==='radio'||child.type==='checkbox'){if(child.value()===value.toString()){child.prop('checked',!0)}}else{child.value(value)}});echo({url:atheos.controller,data:{target:'settings',action:'save',key,value},success:function(reply){if(reply.status==='error'){atheos.toast.show(reply)}else if(!hidden){reply.text='Setting "'+key+'" saved.';self.displayStatus(reply)}}});carbon.publish('settings.save')},displayStatus:debounce(function(reply){atheos.toast.show(reply)},1000),show:function(dataFile){atheos.modal.load(800,{target:'settings',action:'openDialog',callback:function(){if(typeof(dataFile)==='string'){self.showTab(dataFile)}else{self.loadTabValues()}}})},showTab:function(target){self.save(!1);var dest=target.attr('data-panel')||target.attr('data-file');if(target.attr('data-panel')){echo({url:atheos.dialog,data:{target:'settings',action:'loadPanel',panel:dest},success:function(reply){oX('.settings menu .active').removeClass('active');oX('.settings menu a[data-panel="'+dest+'"]').addClass('active');oX('.settings panel').html(reply);self.loadTabValues()}})}else if(target.attr('data-file')){echo({url:dest,success:function(reply){oX('.settings panel').html(reply);self.loadTabValues(dataFile)}})}}};atheos.settings=self})();

//////////////////////////////////////////////////////////////////////////////80
// components/sidebars/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';let editor=null,workspace=null,handleWidth=0,hoverDuration=300;const self={dragging:!1,init:function(){editor=oX('#EDITOR');workspace=oX('#workspace');left.init();right.init();carbon.subscribe('settings.loaded',function(){handleWidth=oX('.handle').width();hoverDuration=storage('sidebars.hoverDuration')||300;left.trigger=storage('sidebars.leftTrigger')||'hover';right.trigger=storage('sidebars.rightTrigger')||'hover';if(storage('sidebars.leftLockedVisible')===!1){fX('#SBLEFT .lock').trigger('click')}
if(storage('sidebars.rightLockedVisible')===!1){fX('#SBRIGHT .lock').trigger('click')}
let sbLeftWidth=storage('sidebars.sb-left-width'),sbRightWidth=storage('sidebars.sb-right-width');if(sbLeftWidth!==null){sbLeftWidth=parseInt(sbLeftWidth,10);oX('#SBLEFT').css('width',sbLeftWidth+'px')}
if(sbRightWidth!==null){sbRightWidth=parseInt(sbRightWidth,10);oX('#SBRIGHT').css('width',sbRightWidth+'px')}
if(!left.lockedVisible&&sbLeftWidth!==null){left.element.addClass('unlocked');oX('#SBLEFT').css('left',((sbLeftWidth-handleWidth)*-1)+'px');workspace.css('padding-left',handleWidth+'px')}
if(!right.lockedVisible&&sbRightWidth!==null){right.element.addClass('unlocked');oX('#SBRIGHT').css('right',((sbRightWidth-handleWidth)*-1)+'px');workspace.css('padding-right',handleWidth+'px')}})},resize:function(sidebar,side){if(sidebar===null)return;var rect=sidebar.getBoundingClientRect(),modalX=rect.left,width;self.dragging=!0;var moveElement=function(event){if(side==='left'){width=(modalX+event.clientX+10)}else{width=(window.innerWidth-event.clientX+10)}
width=width>14?width+'px':'15px';sidebar.style.width=width};function removeListeners(){setTimeout(function(){atheos.settings.save('sidebars.sb-'+side+'-width',width)},200);storage('sidebars.sb-'+side+'-width',width);self.dragging=!1;document.removeEventListener('mousemove',moveElement,!1);document.removeEventListener('mouseup',removeListeners,!1)}
document.addEventListener('mousemove',moveElement,!1);document.addEventListener('mouseup',removeListeners,!1)}};const left={element:null,handle:'#SBLEFT .handle',icon:null,timeoutOpen:null,timeoutClose:null,trigger:'hover',lockedVisible:!0,isOpen:!0,init:function(){this.element=oX('#SBLEFT');this.icon=oX('#SBLEFT .lock');fX('#SBLEFT .lock').on('click',()=>this.lock());fX(this.handle).on('mousedown',()=>{self.resize(this.element.element,'left')});fX(this.handle).on('click',()=>{if(!self.dragging&&this.trigger==='click'){this.open()}});fX('#SBLEFT').on('mouseover',()=>{if(!self.dragging&&this.trigger==='hover'){this.open()}});fX('#SBLEFT').on('mouseout',(event)=>{var trigger=this.element.element,destination=event.toElement||event.relatedTarget,mouseLeft=(destination===trigger)?!0:!trigger.contains(destination);if(!self.dragging&&mouseLeft)this.close()})},open:function(){var sidebarWidth=this.element.width();if(this.timeoutClose)clearTimeout(this.timeoutClose);this.timeoutOpen=setTimeout(()=>{this.element.css('left','0px');setTimeout(()=>{this.isOpen=!0;atheos.active.updateTabDropdownVisibility();fX('#EDITOR').trigger('h-resize-root')},300)},hoverDuration)},close:function(){var sidebarWidth=this.element.width();if(this.timeoutOpen)clearTimeout(this.timeoutOpen);this.timeoutClose=setTimeout(()=>{if(this.lockedVisible)return;this.element.css('left',-(sidebarWidth-handleWidth)+'px');setTimeout(()=>{this.isOpen=!1;atheos.active.updateTabDropdownVisibility();fX('#EDITOR').trigger('h-resize-root')},300)},hoverDuration)},lock:function(){if(this.lockedVisible){this.icon.replaceClass('fa-lock','fa-unlock');this.element.addClass('unlocked');workspace.css('padding-left',handleWidth+'px')}else{this.icon.replaceClass('fa-unlock','fa-lock');this.element.removeClass('unlocked');workspace.css('padding-left','')}
this.lockedVisible=!(this.lockedVisible);atheos.settings.save('sidebars.leftLockedVisible',this.lockedVisible,!0);storage('sidebars.leftLockedVisible',this.lockedVisible)}};const right={element:null,handle:'#SBRIGHT .handle',icon:null,timeoutOpen:null,timeoutClose:null,trigger:'hover',lockedVisible:!0,isOpen:!0,init:function(){this.element=oX('#SBRIGHT');this.icon=oX('#SBRIGHT .lock');fX('#SBRIGHT .lock').on('click',()=>this.lock());fX(this.handle).on('mousedown',()=>{self.resize(this.element.element,'right')});fX(this.handle).on('mousedown',()=>{if(!self.dragging&&this.trigger==='click'){this.open()}});fX('#SBRIGHT').on('mouseover',()=>{if(!self.dragging&&this.trigger==='hover'){this.open()}});fX('#SBRIGHT').on('mouseout',(event)=>{var trigger=this.element.element,destination=event.toElement||event.relatedTarget,mouseLeft=(destination===trigger)?!0:!trigger.contains(destination);if(!self.dragging&&mouseLeft)this.close()})},open:function(){var sidebarWidth=this.element.width();if(this.timeoutClose)clearTimeout(this.timeoutClose);this.timeoutOpen=setTimeout(()=>{this.element.css('right','0px');setTimeout(()=>{this.isOpen=!0;atheos.active.updateTabDropdownVisibility();fX('#EDITOR').trigger('h-resize-root')},300)},hoverDuration)},close:function(){var sidebarWidth=this.element.width();if(this.timeoutOpen)clearTimeout(this.timeoutOpen);this.timeoutClose=setTimeout(()=>{if(this.lockedVisible)return;this.element.css('right',-(sidebarWidth-handleWidth)+'px');setTimeout(()=>{this.isOpen=!1;atheos.active.updateTabDropdownVisibility();fX('#EDITOR').trigger('h-resize-root')},300)},hoverDuration)},lock:function(){if(this.lockedVisible){this.icon.replaceClass('fa-lock','fa-unlock');this.element.addClass('unlocked');workspace.css('padding-right',handleWidth+'px')}else{this.icon.replaceClass('fa-unlock','fa-lock');this.element.removeClass('unlocked');workspace.css('padding-right','')}
this.lockedVisible=!(this.lockedVisible);atheos.settings.save('sidebars.rightLockedVisible',this.lockedVisible,!0);storage('sidebars.rightLockedVisible',this.lockedVisible)}};atheos.sidebars=self;atheos.sidebars.sbLeft=left;atheos.sidebars.sbRight=right;carbon.subscribe('system.loadMinor',()=>self.init())})();

//////////////////////////////////////////////////////////////////////////////80
// components/textmode/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(global){'use strict';var atheos=global.atheos;var self=null;carbon.subscribe('system.loadMinor',()=>atheos.textmode.init());atheos.textmode={extensionMap:{},availableModes:[],init:function(){self=this;echo({url:atheos.controller,data:{target:'textmode',action:'loadExtensionMap'},success:function(reply){if(reply.status==='success'){delete reply.status;self.extensionMap=reply.extensionMap;self.availableModes=reply.modes;self.createModeMenu()}}});atheos.common.initMenuHandler('#current_mode','#changemode_menu')},createModeMenu:function(){var menu=oX('#changemode_menu');var modeOptions=[];var maxOptionsColumn=15;var firstOption=0;var max;self.availableModes.sort();self.availableModes.forEach((mode)=>{modeOptions.push('<li><a>'+mode+'</a></li>')});var html='<table><tr>';while(!0){html+='<td><ul>';if((modeOptions.length-firstOption)<maxOptionsColumn){max=modeOptions.length}else{max=firstOption+maxOptionsColumn}
var currentcolumn=modeOptions.slice(firstOption,max);for(var option in currentcolumn){html+=currentcolumn[option]}
html+='</ul></td>';firstOption=firstOption+maxOptionsColumn;if(firstOption>=modeOptions.length){break}}
html+='</tr></table>';menu.html(html);fX('#changemode_menu').on('click',function(e){e.stopPropagation();var node=oX(e.target);var tagName=e.target.tagName;if(tagName!=='A'){return!1}
var newMode='ace/mode/'+node.text();var activeSession=atheos.editor.activeInstance.getSession();var fn=function(){self.setModeDisplay(activeSession);activeSession.removeListener('changeMode',fn)};activeSession.on('changeMode',fn);activeSession.setMode(newMode)})},selectMode:function(extension){if(typeof(extension)!=='string'){return'text'}
extension=extension.toLowerCase();if(extension in self.extensionMap){return self.extensionMap[extension]}else if(self.availableModes.includes(extension)){return extension}else{return'text'}},setModeDisplay:function(session){if(!session){return}
var currMode=session.getMode().$id;if(currMode){currMode=currMode.substring(currMode.lastIndexOf('/')+1);oX('#current_mode>span').html(currMode)}else{oX('#current_mode>span').html('text')}},saveExtensions:function(){var form=oX('#textmodes');var modes=form.findAll('input, select');var data={target:'textmode',action:'saveExtensionMap',map:{extension:[],textmode:[]}};for(var i=0;i<modes.length;i++){var field=modes[i].element;if(field.name!=='extension'&&field.name!=='textmode'){continue}
data.map[field.name].push(field.value)}
data.map=JSON.stringify(data.map);echo({url:atheos.controller,data:data,settled:function(status,reply){atheos.toast.show(status,reply.message);if(status!=='error'&&reply.extensions){self.setEditorTextModes(reply)}}})},addFieldToForm:function(){var extensions=oX('#textmodes');var html='<tr><td><input type="text" name="extension" value="" /></td>';html+='<td><select name="textmode">';self.availableModes.forEach((mode)=>{html+='<option>'+mode+'</option>'});html+='</select></td></tr>';extensions.append(html)}}})(this);

//////////////////////////////////////////////////////////////////////////////80
// components/transfer/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';const self={init:function(){fX('#dialog .transfer').on('change',self.upload)},download:function(anchor){let path=anchor.path,type=pathinfo(path).type;echo({url:atheos.controller,data:{target:'transfer',action:'download',path,type},settled:function(status,reply){if(status==='success'){oX('#download').attr('src','components/transfer/download.php?filename='+encodeURIComponent(reply.download))}else{atheos.toast.show('error',reply.text)}}})},uploadPath:!1,upload:function(e){e.preventDefault();e.stopPropagation();log('test');var input=oX('#dialog input[type="file"]').element,fileCount=input.files.length,uploadName;if(fileCount<=0)return;uploadName=fileCount>=1?input.files[0].name:'Batch Upload';var progressNode=oX('<div class="upload-progress"><div></div><span></span></div>');oX('#progress_wrapper').append(progressNode);var data=new FormData();for(var x=0;x<fileCount;x++){data.append('upload[]',input.files[x])}
data.append('target','transfer');data.append('action','upload');data.append('path',self.uploadPath);var send=new XMLHttpRequest();send.upload.addEventListener('progress',self.showProgress(progressNode,uploadName),!1);send.addEventListener('error',self.showProgress(progressNode,uploadName),!1);send.open('POST',atheos.controller);send.onreadystatechange=function(){if(send.readyState===4){var reply=send.responseText;try{reply=JSON.parse(reply)}catch(e){}
if(send.status>=200&&send.status<300){self.processUpload(reply,self.uploadPath)}else{self.showProgress(progressNode,uploadName)({type:'error'})}
input.value=''}};send.send(data)},openUpload:function(anchor){self.uploadPath=anchor.path;atheos.modal.load(400,{target:'transfer',action:'upload',path:self.uploadPath})},processUpload:function(reply,path){if(reply.status!=='success'){atheos.toast.show('error',reply.text)}
reply.data.forEach(function(file){atheos.filemanager.addToFileManager(path+'/'+file.name,'file',path);carbon.publish('filemanager.upload',{name:file.name,path:path})})},showProgress:function(node,name){var total;function formatBytes(bytes,decimals=1){if(bytes===0){return'0B'}
const k=1024;const dm=decimals<0?0:decimals;const sizes=['B','KB','MB','GB','TB','PB','EB','ZB','YB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(dm))+sizes[i]}
return function(event){if(event.type==='progress'){total=formatBytes(event.total);var percent=parseInt((event.loaded/event.total)*100,10);node.find('span').text(`${name}: ${percent}% (${formatBytes(event.loaded)}/${total})`);node.find('div').css('width',Math.round(percent)+'%');if(percent===100){setTimeout(function(){atheos.flow.slide('remove',node.element,500)},3000)}}else{node.find('span').text(`${name}: Upload failed...`);node.find('div').css('width','100%');node.find('div').addClass('error')}}}};carbon.subscribe('system.loadMinor',()=>self.init());atheos.transfer=self})();

//////////////////////////////////////////////////////////////////////////////80
// components/update/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(global){'use strict';var atheos=global.atheos;var self=null;carbon.subscribe('system.loadExtra',()=>atheos.update.init());atheos.update={github:null,init:function(){self=this;echo({url:atheos.controller,data:{target:'update',action:'init'},settled:function(status,reply){if(status!=='success')return;self.github=reply.github;if(reply.request){self.loadLatest()}}})},download:function(){var archive=oX('#dialog form input[name="archive"]').value();oX('#download').attr('src',archive);echo({url:atheos.controller,data:{target:'update',action:'clear'}});atheos.modal.unload()},check:function(){atheos.modal.load(500,{target:'update',action:'check'})},loadLatest(){echo({url:self.github,settled:function(status,reply){if(status==='success')self.saveCache(reply)}})},saveCache:function(cache){echo({url:atheos.controller,data:{target:'update',action:'saveCache',cache:JSON.stringify(cache)}})}}})(this);

//////////////////////////////////////////////////////////////////////////////80
// components/user/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(){'use strict';const self={loginForm:null,init:function(){self.loginForm=oX('#login');if(self.loginForm){fX('#login').on('submit',function(e){e.preventDefault();if(oX('#remember').prop('checked')){storage('username',oX('#username').value());storage('remember',!0)}else{storage('username',!1);storage('remember',!1);oX('#password').focus()}
storage('language',oX('#language').value());self.authenticate(e.target)});let element;let username=storage('username'),remember=storage('remember'),language=storage('language');if(username&&remember){element=oX('#username');oX('#username').value(username);oX('#remember').prop('checked',!0);oX('#password').focus()}
element=oX('#language');if(element.exists()&&element.findAll('option').length>1){element.findAll('option').forEach(function(option){if(option.value()===language){option.attr('selected','selected')}})}
fX('#show_login_options').on('click',function(e){e.preventDefault();oX(e.target).hide();oX('#hide_login_options').show('inline-block');oX('#login_options').show()});fX('#hide_login_options').on('click',function(e){e.preventDefault();oX(e.target).hide();oX('#show_login_options').show('inline-block');oX('#login_options').hide()})}else{carbon.subscribe('chrono.tera',function(){echo({data:{'target':'user','action':'keepAlive'},settled:function(status,reply){if(status!=='success'){atheos.user.logout()}}})})}
fX('#aclSelect').on('change',function(e){let aclSelect=oX(e.target),projectSelect=oX('#projectSelect').element,direction=aclSelect.value()==='full'?'close':'open';atheos.flow.slide(direction,projectSelect,300)})},authenticate:function(form){let data=serialize(form);if(data.password===''||data.username===''){return toast('notice','Username/Password not provided.')}
data.target='user';data.action='authenticate';echo({data:data,settled:function(status,reply){if(status==='success'){window.location.reload()}
toast(status,reply)}})},changePassword:function(username){let listener=function(e){e.preventDefault();let data=serialize(e.target);let vPass=data.password===data.validate;if(!vPass)return toast('error','Passwords do not match.');echo({data:{target:'user',action:'changePassword',username:username,password:data.password},settled:function(status,reply){toast(status,reply);if(status!=='error'){atheos.modal.unload()}}})};atheos.modal.load(400,{target:'user',action:'changePassword',username,listener})},create:function(){let listener=function(e){e.preventDefault();let data=serialize(e.target);let vUser=!(/^[^A-Za-z0-9\-\_\@\.]+$/i.test(data.username))&&data.username.length!==0,vPass=data.password===data.validate;if(!vUser)return toast('error','Username must be an alphanumeric string');if(!vPass)return toast('error','Passwords do not match.');echo({data:{target:'user',action:'create',username:data.username,password:data.password},settled:function(status,reply){toast(status,reply);if(status!=='error'){self.list()}}})};atheos.modal.load(400,{target:'user',action:'create',listener})},delete:function(username){let listener=function(e){e.preventDefault();echo({data:{target:'user',action:'delete',username:username},settled:function(status,reply){toast(status,reply);if(status!=='error'){self.list()}}})};atheos.modal.load(400,{target:'user',action:'delete',username,listener})},list:function(){atheos.modal.load(400,{target:'user',action:'list'})},logout:function(){let postLogout=function(){carbon.publish('user.logout');atheos.settings.save();echo({data:{target:'user',action:'logout'},settled:function(){window.location.reload()}})};let changedTabs=atheos.active.unsavedChanges();if(changedTabs){atheos.active.focus(changedTabs[0]);let changes='';changedTabs.forEach(function(path,i){changes+=pathinfo(path).basename+'\n'});let dialog={banner:'You have unsaved changes.',data:changes,actions:{'Save All & Close':function(){atheos.active.saveAll();postLogout()},'Discard Changes':function(){for(let path in atheos.active.sessions){atheos.active.sessions[path].status='current'}
postLogout()},'Cancel':function(){}}};atheos.alert.show(dialog)}else{postLogout()}},saveActiveProject:function(name,path){echo({data:{target:'user',action:'saveActiveProject',name,path}})},showUserACL:function(username){let listener=function(e){e.preventDefault();let data=serializeForm(e.target);data.target='user';data.action='updateACL';data.username=username;if(data.userACL!=='full'){data.userACL=data.project}
delete data.project;if(data.userACL!=='full'&&data.userACL.length<0){toast('error','At least one project must be selected')}else{echo({data:data,settled:function(status,reply){toast(status,reply);if(status!=='error'){atheos.modal.unload()}}})}};atheos.modal.load(400,{target:'user',action:'showUserACL',username,listener})}};carbon.subscribe('system.loadMinor',()=>self.init());atheos.user=self})();

//////////////////////////////////////////////////////////////////////////////80
// components/worker/init.js 
//////////////////////////////////////////////////////////////////////////////80
(function(global){'use strict';var atheos=global.atheos,carbon=global.carbon;var self=null;carbon.subscribe('system.loadMajor',()=>atheos.workerManager.init());atheos.workerManager={taskQueue:[],init:function(){self=this},addTask:function(taskConfig,callback,context){if(self.worker!==null){self.taskQueue.push({config:taskConfig,callback:callback,context:context});self.clearSubsidableTasks(taskConfig.id);if(!self.workerRunning()){var initStatus=self.initiateWorker();if(!initStatus){callback(null,!1);return}
self.worker.addEventListener('message',function(e){self.concludeTask(e.data)},!1)}
if(self.taskQueue.length===1){self.scheduleNext()}}else{callback(!1,taskConfig.id)}},workerRunning:function(){return!!self.worker},initiateWorker:function(){if(typeof Worker!=='undefined'&&Worker!==null){self.worker=new Worker('components/worker/worker.js');return!!self.worker}},clearSubsidableTasks:function(id){var i=self.taskQueue.length-2;while(i>0){if(self.taskQueue[i].id===id){self.taskQueue.splice(i,1)}
i--}},scheduleNext:function(){var taskConfig=self.taskQueue[0].config;self.worker.postMessage(taskConfig)},concludeTask:function(msg){if(self.taskQueue.length>0){var tq=self.taskQueue[0];var callback=tq.callback;var context=tq.context;self.taskQueue.splice(0,1);if(self.taskQueue.length>0){self.scheduleNext()}
callback.apply(context,[msg.success,msg.result])}}}})(this);
